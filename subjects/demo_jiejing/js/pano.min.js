function swipe(a, b, c) {
    this.startPosition = {
        x: 0,
        y: 0
    },
    this.endPosition = {
        x: 0,
        y: 0
    },
    this.deltaX = 0,
    this.deltaY = 0,
    this.startMoveTime = 0,
    this.endMoveTime = 0,
    this.moveTime = 0,
    this.durat = 0,
    this.container = a,
    this.init(a, b, c)
}
function movephotolistleft(a, b, c) {
    var d = /\-?[0-9]+\.?[0-9]*/g,
    e = getComputedStyle(b).webkitTransform || getComputedStyle(b).mozTransform || getComputedStyle(b).msTransform || getComputedStyle(b).oTransform || getComputedStyle(b).transform,
    f = parseFloat(e.match(d)[4]);
    f += a.deltaX,
    f < $(c).width() - 6 - $(b).width() && (f = $(c).width() - 6 - $(b).width()),
    f > 0 && (f = 0),
    $(b).css({
        "transition-timing-function": "cubic-bezier(0.33, 0.66, 0.66, 1)",
        "-webkit-transition-timing-function": "cubic-bezier(0.33, 0.66, 0.66, 1)",
        "-moz-transition-timing-function": "cubic-bezier(0.33, 0.66, 0.66, 1)",
        "-ms-transition-timing-function": "cubic-bezier(0.33, 0.66, 0.66, 1)",
        "-o-transition-timing-function": "cubic-bezier(0.33, 0.66, 0.66, 1)",
        "transition-duration": a.durat + "ms",
        "-webkit-transition-duration": a.durat + "ms",
        "-moz-transition-duration": a.durat + "ms",
        "-ms-transition-duration": a.durat + "ms",
        "-o-transition-duration": a.durat + "ms",
        "-webkit-transform": "translateX(" + f + "px)",
        "-moz-transform": "translateX(" + f + "px)",
        "-ms-transform": "translateX(" + f + "px)",
        "-o-transform": "translateX(" + f + "px)",
        transform: "translateX(" + f + "px)"
    })
}
function movephotolistup(a, b, c) {
    var d = /\-?[0-9]+\.?[0-9]*/g,
    e = getComputedStyle(b).webkitTransform || getComputedStyle(b).mozTransform || getComputedStyle(b).msTransform || getComputedStyle(b).oTransform || getComputedStyle(b).transform,
    f = parseFloat(e.match(d)[5]);
    f += a.deltaY,
    f < $(c).height() - $(b).height() && (f = $(c).height() - $(b).height()),
    f > 0 && (f = 0),
    $(b).css({
        "transition-timing-function": "cubic-bezier(0.33, 0.66, 0.66, 1)",
        "-webkit-transition-timing-function": "cubic-bezier(0.33, 0.66, 0.66, 1)",
        "-moz-transition-timing-function": "cubic-bezier(0.33, 0.66, 0.66, 1)",
        "-ms-transition-timing-function": "cubic-bezier(0.33, 0.66, 0.66, 1)",
        "-o-transition-timing-function": "cubic-bezier(0.33, 0.66, 0.66, 1)",
        "transition-duration": a.durat + "ms",
        "-webkit-transition-duration": a.durat + "ms",
        "-moz-transition-duration": a.durat + "ms",
        "-ms-transition-duration": a.durat + "ms",
        "-o-transition-duration": a.durat + "ms",
        "-webkit-transform": "translateY(" + f + "px)",
        "-moz-transform": "translateY(" + f + "px)",
        "-ms-transform": "translateY(" + f + "px)",
        "-o-transform": "translateY(" + f + "px)",
        transform: "translateY(" + f + "px)"
    })
}
function HotPoint() {
    this.container = document.createElement("div"),
    this.container.style.cssText = "position:absolute; right: 50%; bottom: 133px; margin-right:-149px; overflow:hidden;background-color: rgba(0,0,0,0.75);z-index: 1001;",
    this.container2 = document.createElement("div"),
    this.container2.style.cssText = "position:relative;width:263px;height:247px;margin: 14px 18px 14px 18px",
    this.container.appendChild(this.container2),
    this.title = document.createElement("div"),
    this.title.style.cssText = 'width: 263px;font-size:15px;line-height:15px;color:#ffffff; font-family: STHeiti,"华文黑体"; overflow:hidden;margin-bottom:12px;',
    this.container2.appendChild(this.title),
    this.backimage = document.createElement("div"),
    this.backimage.style.cssText = " width: 263px; height: 92px;",
    this.container2.appendChild(this.backimage),
    this.body = document.createElement("div"),
    this.body.id = "hp_container",
    this.body.style.cssText = 'margin-top:10px;height:118px;width:263px;overflow:hidden;line-height: 21px; font-family: STHeiti,"华文黑体";font-size:13px;color:#ffffff;',
    this.container2.appendChild(this.body),
    this.bodyText = document.createElement("p"),
    this.bodyText.id = "hotpoint",
    this.body.appendChild(this.bodyText),
    this.isCreate = !1,
    this.closeCon = document.createElement("div"),
    this.closeCon.className = "closeCon";
    var a = this;
    $(this.closeCon).tap(function() {
        a.close()
    }),
    this.closeEl = document.createElement("div"),
    this.closeEl.className = "close",
    this.closeCon.appendChild(this.closeEl),
    this.container2.appendChild(this.closeCon),
    this.data = null,
    this.swipe_HotPoint = null,
    this.hpScroll = null,
    this.init()
}
function Panorama(a, b) {
    this.panoObj = new qq.pano.Panorama({
        pano: b.svid,
        container: a,
        disableLogo: !0,
        disableCompass: !0,
        disableFullScreen: !0,
        disableMove: !0
    });
    var c = this;
    this.HotWin = new HotPoint,
    this.labels = this.HotWin.data,
    qq.pano.event.addListener(this.panoObj, "labelEvent",
    function(a) {
        "touchstart" == a.type && c.showInfoWin(a.id)
    }),
    qq.pano.event.addListener(this.panoObj, "pano_changed",
    function(a) {
        c.removeLabels(c.labels),
        c.HotWin.close();
        var b = c.checkisIn(a.svid);
        if ( - 1 !== b) {
            var d = {
                id: c.labels[b].id,
                content: c.labels[b].name,
                position: {
                    lat: c.labels[b].lng,
                    lng: c.labels[b].lat
                },
                altitude: c.labels[b].altitude
            };
            c.panoObj.addLabel(d)
        }
    })
}
function Photo(a, b) {
    this.regionId = b.regionid,
    this.container = document.getElementById("albumViewBody"),
    this.pano = a,
    this.swipe_photo = null,
    this.select = null,
    this.dataLoader = null,
    this.photoScroll = null;
    var c = this;
    this._draw(function() {
        c.photoScroll = new IScroll("#albumView", {
            scrollX: !0,
            scrollY: !1
        })
    })
}
function RegionList(a, b) {
    this.container = null,
    this.photo = a,
    this.data = b,
    this.select = null,
    this.swipe_Title = null,
    this.regionScroll = null;
    var c = this;
    this.init(function() {
        c.regionScroll = new IScroll("#albumTitle", {
            scrollX: !0,
            scrollY: !1
        })
    })
}
function Grace(a, b, c, d) {
    b.select && b.select.removeClass("select"),
    b.select = $(a),
    b.select.addClass("select"),
    $("#albumViewBody").children().remove(),
    b.photo.pano.setPano(c),
    b.photo.changeRegion(d)
}
function Message() {
    this.container = document.createElement("div"),
    this.container.style.cssText = "height: 246px; width: 299px; position:absolute; right: 10px; top: 48px;background-color: rgba(0,0,0,0.75);z-index:1001;visibility: hidden;",
    this.body = document.createElement("div"),
    this.body.style.cssText = 'overflow:hidden;line-height: 21px; font-family: STHeiti,"华文黑体";font-size:13px;color:#ffffff;margin:13px 19px 13px 19px;height:220px; width: 261px;',
    this.body.id = "introduce",
    this.container.appendChild(this.body),
    this.isCreate = !1,
    this.data = null,
    this.msgScroll = null;
    var a = this;
    this.init(function() {
        a.msgScroll = new IScroll("#introduce", {
            scrollX: !1,
            scrollY: !0
        })
    })
}
function Control() {
    this.isplay = !0,
    this.isshow = !1,
    this.mesg = new Message,
    this.init()
    //$("#albumTitleBody > li:eq("+e.c_data_index+")").attr("class","select")
}
var swp = swipe.prototype;
swp.init = function(a, b, c) {
    var d = this;
    d.cleanall(c),
    $(a).bind("touchstart",
    function(b) {
        b.preventDefault(),
        d.startMoveTime = d.endMoveTimed = Date.now();
        var e = b.targetTouches[0];
        d.startPosition = {
            x: e.pageX,
            y: e.pageY
        },
        d.deltaX = d.deltaY = 0;
        var f = /\-?[0-9]+\.?[0-9]*/g,
        g = getComputedStyle(a).webkitTransform || getComputedStyle(a).mozTransform || getComputedStyle(a).msTransform || getComputedStyle(a).oTransform || getComputedStyle(a).transform;
        "left" === c && $(a).css({
            "transition-duration": "0ms",
            "-webkit-transition-duration": "0ms",
            "-moz-transition-duration": "0ms",
            "-ms-transition-duration": "0ms",
            "-o-transition-duration": "0ms",
            "-webkit-transform": "translateX(" + g.match(f)[4] + "px)",
            "-moz-transform": "translateX(" + g.match(f)[4] + "px)",
            "-ms-transform": "translateX(" + g.match(f)[4] + "px)",
            "-o-transform": "translateX(" + g.match(f)[4] + "px)",
            transform: "translateX(" + g.match(f)[4] + "px)"
        }),
        "up" === c && $(a).css({
            "transition-duration": "0ms",
            "-webkit-transition-duration": "0ms",
            "-moz-transition-duration": "0ms",
            "-ms-transition-duration": "0ms",
            "-o-transition-duration": "0ms",
            "-webkit-transform": "translateY(" + g.match(f)[5] + "px)",
            "-moz-transform": "translateY(" + g.match(f)[5] + "px)",
            "-ms-transform": "translateY(" + g.match(f)[5] + "px)",
            "-o-transform": "translateY(" + g.match(f)[5] + "px)",
            transform: "translateY(" + g.match(f)[5] + "px)"
        })
    }),
    $(a).bind("touchmove",
    function(e) {
        e.preventDefault();
        var f = e.targetTouches[0];
        d.endPosition = {
            x: f.pageX,
            y: f.pageY
        },
        d.endMoveTime = Date.now(),
        d.deltaX = d.endPosition.x - d.startPosition.x,
        d.deltaY = d.endPosition.y - d.startPosition.y,
        d.moveTime = d.endMoveTime - d.startMoveTime,
        d.durat = 0,
        "left" === c ? movephotolistleft(d, a, b) : movephotolistup(d, a, b),
        d.startPosition = d.endPosition,
        d.startMoveTime = d.endMoveTime
    }),
    $(a).bind("touchend",
    function(e) {
        e.preventDefault();
        var f;
        d.moveTime += Date.now() - d.endMoveTime,
        f = "left" === c ? 0 == d.moveTime ? 0 : d.deltaX / d.moveTime: 0 == d.moveTime ? 0 : d.deltaY / d.moveTime,
        Math.abs(f) < .1 && (f = 0);
        var g = .001;
        d.durat = Math.abs(f) / g;
        var h = f * f / (2 * g);
        d.deltaX = f > 0 ? h: -h,
        "left" === c && movephotolistleft(d, a, b),
        "up" === c && movephotolistup(d, a, b)
    })
},
swp.destroy = function() {
    $(this.container).unbind(),
    this.container = null
},
swp.cleanall = function(a) {
    "left" === a && $(this.container).css({
        "transition-duration": "0ms",
        "-webkit-transition-duration": "0ms",
        "-moz-transition-duration": "0ms",
        "-ms-transition-duration": "0ms",
        "-o-transition-duration": "0ms",
        "-webkit-transform": "translateX(0px)",
        "-moz-transform": "translateX(0px)",
        "-ms-transform": "translateX(0px)",
        "-o-transform": "translateX(0px)",
        transform: "translateX(0px)"
    }),
    "up" === a && $(this.container).css({
        "transition-duration": "0ms",
        "-webkit-transition-duration": "0ms",
        "-moz-transition-duration": "0ms",
        "-ms-transition-duration": "0ms",
        "-o-transition-duration": "0ms",
        "-webkit-transform": "translateY(0px)",
        "-moz-transform": "translateY(0px)",
        "-ms-transform": "translateY(0px)",
        "-o-transform": "translateY(0px)",
        transform: "translateY(0px)"
    })
};
var hp = HotPoint.prototype;
hp.init = function() {
    var a = this,
    b = "data/hotpoint.js";
    $.ajax({
        type: "get",
        async: !1,
        url: b,
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        cache: !1,
        success: function(b) {
            a.data = b
        },
        error: function(a) {
        	alert("111");
            alert(a)
        }
    }),
    this.container.style.height = "275px",
    this.container.style.width = "299px"
},
hp.showInfoWin = function(a, b, c) {
    $("#introCon").css("display", "none"),
    $("#voice").css("display", "none"),
    $("#nn").css("display", "none"),
    this.isCreate ? ($(this.title).find("p").replaceWith(a), $(this.backimage).find("img").replaceWith(b), $(this.bodyText).html(c)) : ($(this.title).append(a), $(this.backimage).append(b), $(this.bodyText).html(c), document.body.appendChild(this.container), this.hpScroll = new IScroll("#hp_container", {
        scrollX: !1,
        scrollY: !0
    }), this.isCreate = !0),
    this.container.style.visibility = "visible"
},
hp.close = function() {
    $("#introCon").css("display", "block"),
    $("#voice").css("display", "block"),
    $("#nn").css("display", "block");
    var a = this;
    a.hpScroll && a.hpScroll.scrollTo(0, 0),
    a.container.parentNode && (a.container.style.visibility = "hidden")
};
var PP = Panorama.prototype;
PP.removeLabels = function(a) {
    for (var b = 0; b < a.length; b++) {
        var c = a[b].id;
        this.panoObj.removeLabel(c)
    }
},
PP.showInfoWin = function(a) {
    for (var b = 0; b < this.labels.length && this.labels[b].id !== a; b++);
    var c = "<p>" + this.labels[b].name + "</p>",
    d = '<img src="' + this.labels[b].imageurl + '" style="width: 100%; height:100%;"/>',
    e = this.labels[b].descp;
    this.HotWin.showInfoWin(c, d, e)
},
PP.checkisIn = function(a) {
    for (var b = 0; b < this.labels.length; b++) if (this.labels[b].svid === a) return b;
    return - 1
},
PP.setPano = function(a) {
    a && this.panoObj.setPano(a)
},
PP.setPov = function(a) {
    a && this.panoObj.setPov(a.heading, a.pitch)
},
PP.getPano = function() {
    return this.panoObj.getPano()
};
var photoP = Photo.prototype;
photoP.changeRegion = function(a) {
    this.regionId = a;
    var b = this;
    b.photoScroll && b.photoScroll.scrollTo(0, 0),
    this._draw(function() {
        b.photoScroll.refresh()
    })
},
photoP._draw = function(a) {
    var b = "http://sv.map.qq.com/photos?id=" + this.regionId + "&output=jsonp&cb=?";
    b = "data/" + window.region + "/" + this.regionId + ".json";
    var c = this;
    c.dataLoader && c.dataLoader.abort(),
    c.dataLoader = $.ajax({
        type: "get",
        async: !1,
        url: b,
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        cache: !1,
        success: function(b) {
            var d = b.length;
            if (c.dataLoader = null, b && d) {
                for (var e = 0; d > e; e++) {
                    var f = {
                        svid: b[e].ID,
                        heading: b[e].headind || b[e].heading,
                        pitch: b[e].pitch,
                        name: b[e].Name,
                        audio:b[e].audio
                    };
                    if (c._createCell(f), 0 === e) {
                        var g = f.svid;
                        var music = document.getElementById("music");
                        music.setAttribute("src",f.audio);
                        $("#" + g).find("img").css({
                            "border-color": "#2c9eff"
                        }),
                        c.select = $("#" + g)
                    }
                }
                c.container.style.width = 65 * d + "px",
                a && a()
            }
        },
        error: function(a) {
        	alert("222");
        }
    })
},
photoP._createCell = function(a) {
    function b(b) {
        b.preventDefault(),
        d.pano.setPano(a.svid),
        d.pano.setPov({
            heading: parseInt(a.heading),
            pitch: parseInt(a.pitch)
        }),
        d.select && d.select.find("img").css({
            "border-color": ""
        }),
        d.select = $(this),
        d.select.find("img").css({
            "border-color": "#2c9eff"
        })
    }
    var c = document.createElement("div");
    c.className = "PanoPhotoCell",
    c.id = a.svid;
    var d = this;
    return c.innerHTML = '<img src="http://sv4.map.qq.com//image?svid=' + a.svid + '&source=soso&from=mobilepano&type=exhibit"><div class="PanoPhotoTitle">' + a.name + "</div>",
    window.isMobile ? $(c).tap(b) : $(c).click(b),
    d.container.appendChild(c),
    c
};
var RP = RegionList.prototype;
RP.init = function(a) {
    var b = this,
    c = document.createElement("ul");
    this.container = c;
    var d = document.getElementById("albumTitleBody");
    d.appendChild(c);
    for (var e = 0,f = 0; f < b.data.length; f++) {
        var g = !1;
        0 === f && (g = !0),
        e += b._createLi(b.data[f], g)
    }
    d.style.width = e + 54 + 1 + "px",
    a && a()
    //$("li:eq("+window.c_data_index+")").css("select"),
    //alert(window.c_data_index)
},
RP._createLi = function(a, b) {
    var c = this,
    d = document.createElement("li");
    d.innerHTML = a.name;
    var e = a.svid,
    f = a.regionid;
    return window.isMobile ? $(d).tap(function(a) {
        a.preventDefault(),
        Grace(this, c, e, f)
    }) : $(d).click(function(a) {
        a.preventDefault(),
        Grace(this, c, e, f)
    }),
    b && (c.select = $(d), c.select.addClass("select")),
    c.container.appendChild(d),
    $(d).width()
};
var mp = Message.prototype;
mp.init = function(a) {
    var b = this;
    if (!this.isCreate) {
        var c = "data/" + region + "/" + region + ".json";
        $.ajax({
            type: "get",
            async: !1,
            url: c,
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            cache: !1,
            success: function(a) {
                b.data = {
                    descrp: a[0].Des
                },
                document.title = a[0].Name,
                window._des = a[0].Sum
            },
            error: function(a) {
            	alert("333");
                alert(a)
            }
        }),
        document.body.appendChild(this.container),
        b.body.innerHTML = '<div id="msg" style="text-indent: 2em;">' + b.data.descrp + "</div>",
        this.isCreate = !0
    }
    a && a()
},
mp.show = function() {
    this.container.style.visibility = "visible"
},
mp.close = function() {
    this.container.style.visibility = "hidden",
    this.msgScroll && this.msgScroll.scrollTo(0, 0)
};
var cp = Control.prototype;
cp.init = function() {
    var a = this;
    window.isMobile ? $("#introCon").tap(function() {
        a.isshow ? (a.isshow = !1, $("#voice").css("display", "block"), $("#nn").css("display", "block"), $("#intrologo").removeClass("introDis"), a.mesg.close()) : (a.isshow = !0, $("#voice").css("display", "none"), $("#nn").css("display", "none"), $("#intrologo").addClass("introDis"), a.mesg.show())
    }) : $("#introCon").click(function() {
        a.isshow ? (a.isshow = !1, $("#voice").css("display", "block"), $("#nn").css("display", "block"), $("#intrologo").removeClass("introDis"), a.mesg.close()) : (a.isshow = !0, $("#voice").css("display", "none"), $("#nn").css("display", "none"), $("#intrologo").addClass("introDis"), a.mesg.show())
    })
},
function() {
    var a, b, c, d, e = this;
    e.data = null;
    var f = "data/";
    window.allParam = function() {
        var a = window.location.href.replace(/&amp;/g, "&"),
        b = a.indexOf("#"),
        c = {};
        if (a.indexOf("?") > -1 && b > -1 ? b = Math.min(a.indexOf("?"), a.indexOf("#")) : a.indexOf("?") > -1 && (b = a.indexOf("?")), b > -1) {
            a = a.substring(b + 1),
            a = a.replace(/#/g, "&");
            for (var d = a.split("&"), e = 0, f = d.length, g = null, h = null; f > e; e++) g = d[e].split("=")[0].toLowerCase(),
            h = d[e].substring(d[e].indexOf("=") + 1),
            g = g.indexOf("%u") > -1 ? unescape(g) : g,
            h = h.indexOf("%u") > -1 ? unescape(h) : h,
            c[g] = h;
            c.hasUrlParams = "1"
        }
        return c
    } (),
    window.browser = {
        versions: function() {
            var a = navigator.userAgent;
            navigator.appVersion;
            return {
                trident: a.indexOf("Trident") > -1,
                presto: a.indexOf("Presto") > -1,
                webKit: a.indexOf("AppleWebKit") > -1,
                gecko: a.indexOf("Gecko") > -1 && -1 == a.indexOf("KHTML"),
                mobile: !!a.match(/AppleWebKit.*Mobile.*/) || !!a.match(/AppleWebKit/),
                ios: !!a.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),
                android: a.indexOf("Android") > -1 || a.indexOf("Linux") > -1,
                iPhone: a.indexOf("iPhone") > -1 || a.indexOf("Mac") > -1,
                iPad: a.indexOf("iPad") > -1,
                webApp: -1 == a.indexOf("Safari")
            }
        } (),
        language: (navigator.browserLanguage || navigator.language).toLowerCase()
    },
    (browser.versions.android || browser.versions.iPhone || browser.versions.iPad) && (window.isMobile = !0),
    window.region = allParam.region || "1e5b6da24ef6cd5fbdada7d6d831bdc1",
    window.select_svid = allParam.select_svid || "null",
    $("#logo").css({
        "background-image": "url(" + f + region + "/logo.png)"
    }),
    $.ajax({
        type: "get",
        async: !1,
        url: f + region + "/" + region + "_area.json",
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        cache: !1,
        success: function(a) {
            e.data = [];
            window.c_data_index = 0;
            for (var b = 0; b < a.length; b++) {
                var c = a[b];
                if(c.entrance == window.select_svid)
                {
                	window.c_data_index = b;
                }
                e.data.push({
                    svid: c.entrance,
                    regionid: c.code,
                    name: c.Cla
                })
            }
        },
        error: function(a) {
        	alert("444");
            alert(a)
        }
    }),
    window.pano = a = new Panorama(document.getElementById("pano_holder"), e.data[window.c_data_index]),
    b = new Photo(a, e.data[window.c_data_index]),
    c = new RegionList(b, e.data),
    d = new Control,
    window.onresize = function() {
        a.panoObj.updateViewport()
    }
} ();
//获取cookie
function getCookieValue(cookieName)
{
	var cookieValue = document.cookie;
	var cookieStartAt = cookieValue.indexOf(""+cookieName+"=");
	if(cookieStartAt==-1)
	{
		cookieStartAt = cookieValue.indexOf(cookieName+"=");
	}
	if(cookieStartAt==-1)
	{
		cookieValue = null;
	}
	else
	{
		cookieStartAt = cookieValue.indexOf("=",cookieStartAt)+1;
		cookieEndAt = cookieValue.indexOf(";",cookieStartAt);
		if(cookieEndAt==-1)
		{
			cookieEndAt = cookieValue.length;
		}
		cookieValue = unescape(cookieValue.substring(cookieStartAt,cookieEndAt));//解码latin-1
	}
	return cookieValue;
}
//设置cookie
function setCookie(cookieName,cookieValue)
{
	cookieValue = escape(cookieValue);//编码latin-1
	
	var nowDate = new Date();
	nowDate.setDate(nowDate.getDate()+1);     
	var	cookieExpires = nowDate.toGMTString();
	var cookiePath = ";Path=/";
	
	document.cookie = cookieName+"="+cookieValue+cookiePath;
}
//删除cookies  
function delCookie(name)  
{  
    var exp = new Date();  
    exp.setTime(exp.getTime() - 1);  
    var cval=getCookie(name);  
    if(cval!=null) 
    {
    	document.cookie= name + "="+cval+";expires="+exp.toGMTString();  
    } 
}  
